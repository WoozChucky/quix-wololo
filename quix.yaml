# Quix Project Descriptor
# This file describes the data pipeline and configuration of resources of a Quix Project.

metadata:
  version: 1.0

# This section describes the Deployments of the data pipeline
deployments:
  - name: K8S Metrics Source
    application: Logs Source
    deploymentType: Service
    version: 07915b900f2a72ef176e05170a2d02b6fec2612c
    resources:
      cpu: 200
      memory: 500
      replicas: 1
    desiredStatus: Running
    variables:
      - name: output_metrics
        inputType: OutputTopic
        description: ''
        required: true
        value: k8s-metrics
      - name: K8SEndpoint
        inputType: Secret
        description: ''
        required: true
        secretKey: K8SEndpoint
      - name: K8SClusterCertificateAuthorityData
        inputType: Secret
        description: ''
        required: true
        secretKey: K8SClusterCertificateAuthorityData
      - name: K8SClientCertificateData
        inputType: Secret
        description: ''
        required: true
        secretKey: K8SClientCertificateData
      - name: K8SClientKeyData
        inputType: Secret
        description: ''
        required: true
        secretKey: K8SClientKeyData
      - name: K8SToken
        inputType: Secret
        description: ''
        required: true
        secretKey: K8SToken
      - name: K8SClusterName
        inputType: FreeText
        description: ''
        required: true
        value: DevCluster
  - name: Metrics Alert Detector - Memory
    application: Threshold alert
    deploymentType: Service
    version: 8fbd3c9947fe776455604a82f0e583fb23a14d8a
    resources:
      cpu: 200
      memory: 500
      replicas: 1
    desiredStatus: Running
    variables:
      - name: input
        inputType: InputTopic
        description: This is the input topic for raw data
        required: true
        value: k8s-metrics
      - name: output
        inputType: OutputTopic
        description: This is the output topic for alerts
        required: true
        value: metrics-alerts
      - name: parameterName
        inputType: FreeText
        description: This is the stream's parameter to track
        required: true
        value: memory
      - name: thresholdValue
        inputType: FreeText
        description: This is the threshold's numerical value
        required: true
        value: 1000000000
      - name: bufferMilliSeconds
        inputType: FreeText
        description: How long to wait before waiting for threshold checking (milliseconds)
        required: true
        value: 1
  - name: Metrics Alert Detector - CPU
    application: Threshold alert
    deploymentType: Service
    version: 8fbd3c9947fe776455604a82f0e583fb23a14d8a
    resources:
      cpu: 200
      memory: 500
      replicas: 1
    desiredStatus: Running
    variables:
      - name: input
        inputType: InputTopic
        description: This is the input topic for raw data
        required: true
        value: k8s-metrics
      - name: output
        inputType: OutputTopic
        description: This is the output topic for alerts
        required: true
        value: metrics-alerts
      - name: parameterName
        inputType: FreeText
        description: This is the stream's parameter to track
        required: true
        value: cpu
      - name: thresholdValue
        inputType: FreeText
        description: This is the threshold's numerical value
        required: true
        value: 1000000000
      - name: bufferMilliSeconds
        inputType: FreeText
        description: How long to wait before waiting for threshold checking (milliseconds)
        required: true
        value: 1

# This section describes the Topics of the data pipeline
topics:
  - name: k8s-logs
    persisted: false
    configuration:
      partitions: 1
      replicationFactor: 2
      retentionInMinutes: 1440
      retentionInBytes: 52428800
  - name: k8s-metrics
    persisted: false
    configuration:
      partitions: 1
      replicationFactor: 2
      retentionInMinutes: 1440
      retentionInBytes: 52428800
  - name: metrics-alerts
    persisted: false
    configuration:
      partitions: 1
      replicationFactor: 2
      retentionInMinutes: 1440
      retentionInBytes: 52428800
